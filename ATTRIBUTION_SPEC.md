# Attribution Agent Specification

**Agent:** Attribution
**Role:** Credits, Licensing, and "Commons Good" Compliance
**Input:** Project Metadata (Director, Writer, Voice, Composer, Editor outputs)
**Output:** `credits.json`, `attribution_slate.png` (optional), `final_package.zip`
**Implementation:** `netlify/functions/generate-attribution.ts`

---

## 1. Purpose
The Attribution Agent is the "conscience" of the pipeline. It ensures that all AI-generated assets (ElevenLabs voice, Suno music, stock footage) are properly credited. It embodies the "Commons Good" philosophy by generating a transparent record of provenance for the final video.

## 2. Input Schema
The agent accepts a JSON payload containing the outputs from previous agents.

```json
{
  "projectId": "string",
  "directorOutput": {
    "curated_media": [
      { "id": "vid_001", "source": "Pexels", "photographer": "Jane Doe", "url": "..." }
    ]
  },
  "writerOutput": {
    "narrative": { "title": "My Video", "author": "SirTrav AI" }
  },
  "voiceOutput": {
    "provider": "ElevenLabs",
    "voiceId": "..."
  },
  "composerOutput": {
    "provider": "Suno",
    "trackTitle": "Epic Rise",
    "attributionRequired": true
  },
  "editorOutput": {
    "finalVideoUrl": "https://..."
  }
}
```

## 3. Output Schema
The agent returns a JSON object with the compiled credits and a package manifest.

```json
{
  "credits": {
    "visuals": ["Footage by Jane Doe via Pexels"],
    "audio": ["Voice by ElevenLabs", "Music generated by Suno"],
    "production": ["Produced by SirTrav A2A Studio"]
  },
  "provenance": {
    "generatedAt": "ISO_TIMESTAMP",
    "pipelineVersion": "1.4.0",
    "commonsGoodLicense": "CC-BY-SA 4.0"
  },
  "artifacts": {
    "creditsJsonUrl": "https://.../credits.json",
    "finalPackageUrl": "https://.../final_package.zip"
  }
}
```

## 4. Logic & Workflow
1.  **Ingest Metadata:** Read outputs from Director, Writer, Voice, and Composer.
2.  **Compile Credits:**
    *   Extract photographer names from Director's media list.
    *   Identify AI models used (ElevenLabs, Suno).
    *   Add standard studio attribution.
3.  **Format Output:** Generate a structured `credits.json` file.
4.  **Package (Optional):** Create a ZIP file containing the final video and the credits file (for "Commons Good" distribution).

## 5. Memory Integration
*   **Reads:** None.
*   **Writes:** Updates `memory_index.json` with the final attribution data for the project.

## 6. Error Handling
*   **Missing Metadata:** If a source is missing attribution info, log a warning and use "Unknown Source".
*   **Critical Failure:** If `credits.json` cannot be generated, the pipeline should not fail, but alert the Publisher agent.

## 7. Testing
```bash
curl -X POST http://localhost:8888/generate-attribution \
  -H "Content-Type: application/json" \
  -d @tests/fixtures/attribution_input.json
```