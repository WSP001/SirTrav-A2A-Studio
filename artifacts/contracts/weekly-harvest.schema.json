{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://sirtrav.com/schemas/weekly-harvest.schema.json",
    "title": "SirTrav Weekly Harvest Contract",
    "description": "Validates the output of scripts/harvest-week.mjs â€” the photo classification and mood tagging pipeline that feeds into weekly-analyze.mjs. Each harvest run produces a JSON array of classified media items with mood, location, and engagement signals.",
    "type": "object",
    "required": [
        "harvestId",
        "weekOf",
        "items",
        "meta"
    ],
    "properties": {
        "harvestId": {
            "type": "string",
            "pattern": "^harvest-[0-9]{4}-W[0-9]{2}(-[a-z0-9]+)?$",
            "description": "Unique harvest ID, format: harvest-YYYY-WNN or harvest-YYYY-WNN-suffix"
        },
        "weekOf": {
            "type": "string",
            "format": "date",
            "description": "ISO 8601 date of the Monday starting the harvest week"
        },
        "runId": {
            "type": "string",
            "description": "Enterprise tracing ID (threaded through all agent calls)"
        },
        "items": {
            "type": "array",
            "items": {
                "$ref": "#/$defs/harvestItem"
            },
            "minItems": 0,
            "description": "Classified media items from the week"
        },
        "meta": {
            "type": "object",
            "required": [
                "totalItems",
                "harvestedAt",
                "source"
            ],
            "properties": {
                "totalItems": {
                    "type": "integer",
                    "minimum": 0,
                    "description": "Total number of items harvested"
                },
                "harvestedAt": {
                    "type": "string",
                    "format": "date-time",
                    "description": "ISO 8601 timestamp when harvest completed"
                },
                "source": {
                    "type": "string",
                    "enum": [
                        "local-photos",
                        "cloud-storage",
                        "social-feed",
                        "manual-upload"
                    ],
                    "description": "Where the media was sourced from"
                },
                "durationMs": {
                    "type": "integer",
                    "minimum": 0,
                    "description": "Time taken to complete harvest in milliseconds"
                },
                "errors": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "required": [
                            "file",
                            "error"
                        ],
                        "properties": {
                            "file": {
                                "type": "string"
                            },
                            "error": {
                                "type": "string"
                            }
                        }
                    },
                    "description": "Any files that failed classification"
                }
            }
        },
        "costManifest": {
            "type": "object",
            "description": "Cost tracking for AI classification calls (Commons Good 20% markup)",
            "properties": {
                "apiCalls": {
                    "type": "integer",
                    "minimum": 0
                },
                "baseCost": {
                    "type": "number",
                    "minimum": 0
                },
                "markup": {
                    "type": "number",
                    "minimum": 0
                },
                "total": {
                    "type": "number",
                    "minimum": 0
                }
            }
        }
    },
    "$defs": {
        "harvestItem": {
            "type": "object",
            "required": [
                "id",
                "filename",
                "mood",
                "classification"
            ],
            "properties": {
                "id": {
                    "type": "string",
                    "description": "Unique item identifier"
                },
                "filename": {
                    "type": "string",
                    "description": "Original filename of the media"
                },
                "mood": {
                    "type": "string",
                    "enum": [
                        "joyful",
                        "adventurous",
                        "contemplative",
                        "energetic",
                        "serene",
                        "dramatic",
                        "playful",
                        "inspiring"
                    ],
                    "description": "AI-classified mood of the media"
                },
                "classification": {
                    "type": "string",
                    "enum": [
                        "travel",
                        "family",
                        "food",
                        "nature",
                        "urban",
                        "event",
                        "portrait",
                        "creative",
                        "other"
                    ],
                    "description": "AI-classified content category"
                },
                "location": {
                    "type": "object",
                    "properties": {
                        "name": {
                            "type": "string",
                            "description": "Human-readable location name"
                        },
                        "lat": {
                            "type": "number",
                            "minimum": -90,
                            "maximum": 90
                        },
                        "lng": {
                            "type": "number",
                            "minimum": -180,
                            "maximum": 180
                        }
                    },
                    "description": "Geolocation data if available"
                },
                "tags": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "AI-generated descriptive tags"
                },
                "confidence": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 1,
                    "description": "AI classification confidence score (0-1)"
                },
                "mediaType": {
                    "type": "string",
                    "enum": [
                        "photo",
                        "video",
                        "audio"
                    ],
                    "description": "Type of media file"
                },
                "capturedAt": {
                    "type": "string",
                    "format": "date-time",
                    "description": "When the media was originally captured"
                },
                "fileSize": {
                    "type": "integer",
                    "minimum": 0,
                    "description": "File size in bytes"
                }
            }
        }
    },
    "additionalProperties": false,
    "examples": [
        {
            "harvestId": "harvest-2026-W07",
            "weekOf": "2026-02-09",
            "runId": "run-harvest-001",
            "items": [
                {
                    "id": "item-001",
                    "filename": "family-beach-sunset.jpg",
                    "mood": "joyful",
                    "classification": "family",
                    "location": {
                        "name": "Santa Monica Beach",
                        "lat": 34.0195,
                        "lng": -118.4912
                    },
                    "tags": [
                        "sunset",
                        "beach",
                        "family",
                        "golden-hour"
                    ],
                    "confidence": 0.92,
                    "mediaType": "photo",
                    "capturedAt": "2026-02-10T17:30:00Z",
                    "fileSize": 4200000
                },
                {
                    "id": "item-002",
                    "filename": "downtown-architecture.jpg",
                    "mood": "contemplative",
                    "classification": "urban",
                    "tags": [
                        "architecture",
                        "downtown",
                        "symmetry"
                    ],
                    "confidence": 0.87,
                    "mediaType": "photo",
                    "capturedAt": "2026-02-11T14:00:00Z",
                    "fileSize": 3100000
                }
            ],
            "meta": {
                "totalItems": 2,
                "harvestedAt": "2026-02-16T08:00:00Z",
                "source": "local-photos",
                "durationMs": 4500,
                "errors": []
            },
            "costManifest": {
                "apiCalls": 2,
                "baseCost": 0.08,
                "markup": 0.016,
                "total": 0.096
            }
        }
    ]
}