{"version":3,"file":"index.js","sources":["../../src/image-wrappers.ts","../../src/instrumentation.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { trace, Span, SpanKind, Attributes } from \"@opentelemetry/api\";\nimport { SpanAttributes } from \"@traceloop/ai-semantic-conventions\";\nimport type { ImageUploadCallback } from \"./types\";\nimport type {\n  ImageGenerateParams,\n  ImageEditParams,\n  ImageCreateVariationParams,\n  ImagesResponse,\n} from \"openai/resources/images\";\n\n/**\n * Calculate completion tokens for image generation based on OpenAI's actual token costs\n *\n * Token costs based on OpenAI documentation:\n * For gpt-image-1:     Square (1024×1024)    Portrait (1024×1536)    Landscape (1536×1024)\n * Low                  272 tokens            408 tokens              400 tokens\n * Medium               1056 tokens           1584 tokens             1568 tokens\n * High                 4160 tokens           6240 tokens             6208 tokens\n *\n * For DALL-E 3:\n * Standard             1056 tokens           1584 tokens             1568 tokens\n * HD                   4160 tokens           6240 tokens             6208 tokens\n */\nfunction calculateImageGenerationTokens(\n  params: any,\n  imageCount: number,\n): number {\n  const size = params?.size || \"1024x1024\";\n  const model = params?.model || \"dall-e-2\";\n  const quality = params?.quality || \"standard\";\n\n  // Token costs for different models and sizes\n  let tokensPerImage: number;\n\n  if (model === \"dall-e-2\") {\n    // DALL-E 2 has fixed costs regardless of quality\n    const dalle2Costs: Record<string, number> = {\n      \"256x256\": 68,\n      \"512x512\": 272,\n      \"1024x1024\": 1056,\n    };\n    tokensPerImage = dalle2Costs[size] || 1056;\n  } else if (model === \"dall-e-3\") {\n    // DALL-E 3 costs depend on quality and size\n    const dalle3Costs: Record<string, Record<string, number>> = {\n      standard: {\n        \"1024x1024\": 1056,\n        \"1024x1792\": 1584,\n        \"1792x1024\": 1568,\n      },\n      hd: {\n        \"1024x1024\": 4160,\n        \"1024x1792\": 6240,\n        \"1792x1024\": 6208,\n      },\n    };\n    tokensPerImage =\n      dalle3Costs[quality]?.[size] || dalle3Costs[\"standard\"][\"1024x1024\"];\n  } else {\n    // Default fallback for unknown models\n    tokensPerImage = 1056;\n  }\n\n  return tokensPerImage * imageCount;\n}\n\nasync function processImageInRequest(\n  image: any,\n  traceId: string,\n  spanId: string,\n  uploadCallback: ImageUploadCallback,\n  index = 0,\n): Promise<string | null> {\n  try {\n    let base64Data: string;\n    let filename: string;\n\n    if (typeof image === \"string\") {\n      // Could be a file path, base64 string, or URL\n      if (image.startsWith(\"data:image/\")) {\n        const commaIndex = image.indexOf(\",\");\n        base64Data = image.substring(commaIndex + 1);\n        filename = `input_image_${index}.png`;\n      } else if (image.startsWith(\"http\")) {\n        return null;\n      } else {\n        base64Data = image;\n        filename = `input_image_${index}.png`;\n      }\n    } else if (image && typeof image === \"object\") {\n      // Handle Node.js Buffer objects and ReadStream\n      if (Buffer.isBuffer(image)) {\n        base64Data = image.toString(\"base64\");\n        filename = `input_image_${index}.png`;\n      } else if (image.read && typeof image.read === \"function\") {\n        const chunks: Buffer[] = [];\n        return new Promise((resolve) => {\n          image.on(\"data\", (chunk: Buffer) => chunks.push(chunk));\n          image.on(\"end\", async () => {\n            try {\n              const buffer = Buffer.concat(chunks);\n              const base64Data = buffer.toString(\"base64\");\n              const filename = image.path || `input_image_${index}.png`;\n              const url = await uploadCallback(\n                traceId,\n                spanId,\n                filename,\n                base64Data,\n              );\n              resolve(url);\n            } catch (error) {\n              console.error(\"Error processing stream image:\", error);\n              resolve(null);\n            }\n          });\n          image.on(\"error\", (error: Error) => {\n            console.error(\"Error reading image stream:\", error);\n            resolve(null);\n          });\n        });\n      } else {\n        return null;\n      }\n    } else {\n      return null;\n    }\n\n    const url = await uploadCallback(traceId, spanId, filename, base64Data);\n    return url;\n  } catch (error) {\n    console.error(\"Error processing image in request:\", error);\n    return null;\n  }\n}\n\nexport function setImageGenerationRequestAttributes(\n  span: Span,\n  params: ImageGenerateParams,\n): void {\n  const attributes: Attributes = {};\n\n  if (params.model) {\n    attributes[SpanAttributes.LLM_REQUEST_MODEL] = params.model;\n  }\n\n  if (params.size) {\n    attributes[\"gen_ai.request.image.size\"] = params.size;\n  }\n\n  if (params.quality) {\n    attributes[\"gen_ai.request.image.quality\"] = params.quality;\n  }\n\n  if (params.style) {\n    attributes[\"gen_ai.request.image.style\"] = params.style;\n  }\n\n  if (params.n) {\n    attributes[\"gen_ai.request.image.count\"] = params.n;\n  }\n\n  if (params.prompt) {\n    attributes[`${SpanAttributes.LLM_PROMPTS}.0.content`] = params.prompt;\n    attributes[`${SpanAttributes.LLM_PROMPTS}.0.role`] = \"user\";\n  }\n\n  Object.entries(attributes).forEach(([key, value]) => {\n    if (value !== undefined) {\n      span.setAttribute(key, value);\n    }\n  });\n}\n\nexport async function setImageEditRequestAttributes(\n  span: Span,\n  params: ImageEditParams,\n  uploadCallback?: ImageUploadCallback,\n): Promise<void> {\n  const attributes: Attributes = {};\n\n  if (params.model) {\n    attributes[SpanAttributes.LLM_REQUEST_MODEL] = params.model;\n  }\n\n  if (params.size) {\n    attributes[\"gen_ai.request.image.size\"] = params.size;\n  }\n\n  if (params.n) {\n    attributes[\"gen_ai.request.image.count\"] = params.n;\n  }\n\n  if (params.prompt) {\n    attributes[`${SpanAttributes.LLM_PROMPTS}.0.content`] = params.prompt;\n    attributes[`${SpanAttributes.LLM_PROMPTS}.0.role`] = \"user\";\n  }\n\n  // Process input image if upload callback is available\n  if (\n    params.image &&\n    uploadCallback &&\n    span.spanContext().traceId &&\n    span.spanContext().spanId\n  ) {\n    const traceId = span.spanContext().traceId;\n    const spanId = span.spanContext().spanId;\n\n    const imageUrl = await processImageInRequest(\n      params.image,\n      traceId,\n      spanId,\n      uploadCallback,\n      0,\n    );\n\n    if (imageUrl) {\n      attributes[`${SpanAttributes.LLM_PROMPTS}.1.content`] = JSON.stringify([\n        { type: \"image_url\", image_url: { url: imageUrl } },\n      ]);\n      attributes[`${SpanAttributes.LLM_PROMPTS}.1.role`] = \"user\";\n    }\n  }\n\n  Object.entries(attributes).forEach(([key, value]) => {\n    if (value !== undefined) {\n      span.setAttribute(key, value);\n    }\n  });\n}\n\nexport async function setImageVariationRequestAttributes(\n  span: Span,\n  params: ImageCreateVariationParams,\n  uploadCallback?: ImageUploadCallback,\n): Promise<void> {\n  const attributes: Attributes = {};\n\n  if (params.model) {\n    attributes[SpanAttributes.LLM_REQUEST_MODEL] = params.model;\n  }\n\n  if (params.size) {\n    attributes[\"gen_ai.request.image.size\"] = params.size;\n  }\n\n  if (params.n) {\n    attributes[\"gen_ai.request.image.count\"] = params.n;\n  }\n\n  // Process input image if upload callback is available\n  if (\n    params.image &&\n    uploadCallback &&\n    span.spanContext().traceId &&\n    span.spanContext().spanId\n  ) {\n    const traceId = span.spanContext().traceId;\n    const spanId = span.spanContext().spanId;\n\n    const imageUrl = await processImageInRequest(\n      params.image,\n      traceId,\n      spanId,\n      uploadCallback,\n      0,\n    );\n\n    if (imageUrl) {\n      attributes[`${SpanAttributes.LLM_PROMPTS}.0.content`] = JSON.stringify([\n        { type: \"image_url\", image_url: { url: imageUrl } },\n      ]);\n      attributes[`${SpanAttributes.LLM_PROMPTS}.0.role`] = \"user\";\n    }\n  }\n\n  Object.entries(attributes).forEach(([key, value]) => {\n    if (value !== undefined) {\n      span.setAttribute(key, value);\n    }\n  });\n}\n\nexport async function setImageGenerationResponseAttributes(\n  span: Span,\n  response: ImagesResponse,\n  uploadCallback?: ImageUploadCallback,\n  instrumentationConfig?: { enrichTokens?: boolean },\n  params?: any,\n): Promise<void> {\n  const attributes: Attributes = {};\n\n  if (response.data && response.data.length > 0) {\n    const completionTokens = calculateImageGenerationTokens(\n      params,\n      response.data.length,\n    );\n    attributes[SpanAttributes.LLM_USAGE_COMPLETION_TOKENS] = completionTokens;\n\n    // Calculate prompt tokens if enrichTokens is enabled\n    if (instrumentationConfig?.enrichTokens) {\n      try {\n        let estimatedPromptTokens = 0;\n\n        if (params?.prompt) {\n          estimatedPromptTokens += Math.ceil(params.prompt.length / 4);\n        }\n\n        if (params?.image) {\n          estimatedPromptTokens += 272;\n        }\n\n        if (estimatedPromptTokens > 0) {\n          attributes[SpanAttributes.LLM_USAGE_PROMPT_TOKENS] =\n            estimatedPromptTokens;\n        }\n\n        attributes[SpanAttributes.LLM_USAGE_TOTAL_TOKENS] =\n          estimatedPromptTokens + completionTokens;\n      } catch {\n        attributes[SpanAttributes.LLM_USAGE_TOTAL_TOKENS] = completionTokens;\n      }\n    } else {\n      attributes[SpanAttributes.LLM_USAGE_TOTAL_TOKENS] = completionTokens;\n    }\n  }\n\n  if (response.data && response.data.length > 0) {\n    const firstImage = response.data[0];\n\n    if (firstImage.b64_json && uploadCallback) {\n      try {\n        const traceId = span.spanContext().traceId;\n        const spanId = span.spanContext().spanId;\n\n        const imageUrl = await uploadCallback(\n          traceId,\n          spanId,\n          \"generated_image.png\",\n          firstImage.b64_json,\n        );\n\n        attributes[`${SpanAttributes.LLM_COMPLETIONS}.0.content`] =\n          JSON.stringify([{ type: \"image_url\", image_url: { url: imageUrl } }]);\n        attributes[`${SpanAttributes.LLM_COMPLETIONS}.0.role`] = \"assistant\";\n      } catch (error) {\n        console.error(\"Failed to upload generated image:\", error);\n      }\n    } else if (firstImage.url && uploadCallback) {\n      try {\n        const traceId = span.spanContext().traceId;\n        const spanId = span.spanContext().spanId;\n\n        const response = await fetch(firstImage.url);\n        const arrayBuffer = await response.arrayBuffer();\n        const buffer = Buffer.from(arrayBuffer);\n        const base64Data = buffer.toString(\"base64\");\n\n        const uploadedUrl = await uploadCallback(\n          traceId,\n          spanId,\n          \"generated_image.png\",\n          base64Data,\n        );\n\n        attributes[`${SpanAttributes.LLM_COMPLETIONS}.0.content`] =\n          JSON.stringify([\n            { type: \"image_url\", image_url: { url: uploadedUrl } },\n          ]);\n        attributes[`${SpanAttributes.LLM_COMPLETIONS}.0.role`] = \"assistant\";\n      } catch (error) {\n        console.error(\"Failed to fetch and upload generated image:\", error);\n        attributes[`${SpanAttributes.LLM_COMPLETIONS}.0.content`] =\n          JSON.stringify([\n            { type: \"image_url\", image_url: { url: firstImage.url } },\n          ]);\n        attributes[`${SpanAttributes.LLM_COMPLETIONS}.0.role`] = \"assistant\";\n      }\n    } else if (firstImage.url) {\n      attributes[`${SpanAttributes.LLM_COMPLETIONS}.0.content`] =\n        JSON.stringify([\n          { type: \"image_url\", image_url: { url: firstImage.url } },\n        ]);\n      attributes[`${SpanAttributes.LLM_COMPLETIONS}.0.role`] = \"assistant\";\n    }\n\n    if (firstImage.revised_prompt) {\n      attributes[\"gen_ai.response.revised_prompt\"] = firstImage.revised_prompt;\n    }\n  }\n\n  Object.entries(attributes).forEach(([key, value]) => {\n    if (value !== undefined) {\n      span.setAttribute(key, value);\n    }\n  });\n}\n\nexport function wrapImageGeneration(\n  tracer: ReturnType<typeof trace.getTracer>,\n  uploadCallback?: ImageUploadCallback,\n  instrumentationConfig?: { enrichTokens?: boolean },\n) {\n  return function (original: (...args: any[]) => any) {\n    return function (this: any, ...args: any[]) {\n      const params = args[0] as ImageGenerateParams;\n\n      const span = tracer.startSpan(\"openai.images.generate\", {\n        kind: SpanKind.CLIENT,\n        attributes: {\n          [SpanAttributes.LLM_SYSTEM]: \"OpenAI\",\n          \"gen_ai.request.type\": \"image_generation\",\n        },\n      });\n\n      const response = original.apply(this, args);\n\n      if (response && typeof response.then === \"function\") {\n        return response\n          .then(async (result: any) => {\n            try {\n              setImageGenerationRequestAttributes(span, params);\n              await setImageGenerationResponseAttributes(\n                span,\n                result,\n                uploadCallback,\n                instrumentationConfig,\n                params,\n              );\n              return result;\n            } catch (error) {\n              span.recordException(error as Error);\n              throw error;\n            } finally {\n              span.end();\n            }\n          })\n          .catch((error: Error) => {\n            span.recordException(error);\n            span.end();\n            throw error;\n          });\n      } else {\n        try {\n          setImageGenerationRequestAttributes(span, params);\n          return response;\n        } catch (error) {\n          span.recordException(error as Error);\n          throw error;\n        } finally {\n          span.end();\n        }\n      }\n    };\n  };\n}\n\nexport function wrapImageEdit(\n  tracer: ReturnType<typeof trace.getTracer>,\n  uploadCallback?: ImageUploadCallback,\n  instrumentationConfig?: { enrichTokens?: boolean },\n) {\n  return function (original: (...args: any[]) => any) {\n    return function (this: any, ...args: any[]) {\n      const params = args[0] as ImageEditParams;\n\n      const span = tracer.startSpan(\"openai.images.edit\", {\n        kind: SpanKind.CLIENT,\n        attributes: {\n          [SpanAttributes.LLM_SYSTEM]: \"OpenAI\",\n          \"gen_ai.request.type\": \"image_edit\",\n        },\n      });\n\n      const setRequestAttributesPromise = setImageEditRequestAttributes(\n        span,\n        params,\n        uploadCallback,\n      ).catch((error) => {\n        console.error(\"Error setting image edit request attributes:\", error);\n      });\n\n      const response = original.apply(this, args);\n\n      if (response && typeof response.then === \"function\") {\n        return response\n          .then(async (result: any) => {\n            try {\n              await setRequestAttributesPromise;\n              await setImageGenerationResponseAttributes(\n                span,\n                result,\n                uploadCallback,\n                instrumentationConfig,\n                params,\n              );\n              return result;\n            } catch (error) {\n              span.recordException(error as Error);\n              throw error;\n            } finally {\n              span.end();\n            }\n          })\n          .catch(async (error: Error) => {\n            await setRequestAttributesPromise;\n            span.recordException(error);\n            span.end();\n            throw error;\n          });\n      } else {\n        try {\n          return response;\n        } catch (error) {\n          span.recordException(error as Error);\n          throw error;\n        } finally {\n          span.end();\n        }\n      }\n    };\n  };\n}\n\nexport function wrapImageVariation(\n  tracer: ReturnType<typeof trace.getTracer>,\n  uploadCallback?: ImageUploadCallback,\n  instrumentationConfig?: { enrichTokens?: boolean },\n) {\n  return function (original: (...args: any[]) => any) {\n    return function (this: any, ...args: any[]) {\n      const params = args[0] as ImageCreateVariationParams;\n\n      const span = tracer.startSpan(\"openai.images.createVariation\", {\n        kind: SpanKind.CLIENT,\n        attributes: {\n          [SpanAttributes.LLM_SYSTEM]: \"OpenAI\",\n          \"gen_ai.request.type\": \"image_variation\",\n        },\n      });\n\n      const response = original.apply(this, args);\n\n      if (response && typeof response.then === \"function\") {\n        return response\n          .then(async (result: any) => {\n            try {\n              await setImageVariationRequestAttributes(\n                span,\n                params,\n                uploadCallback,\n              );\n              await setImageGenerationResponseAttributes(\n                span,\n                result,\n                uploadCallback,\n                instrumentationConfig,\n                params,\n              );\n              return result;\n            } catch (error) {\n              span.recordException(error as Error);\n              throw error;\n            } finally {\n              span.end();\n            }\n          })\n          .catch((error: Error) => {\n            span.recordException(error);\n            span.end();\n            throw error;\n          });\n      } else {\n        try {\n          return response;\n        } catch (error) {\n          span.recordException(error as Error);\n          throw error;\n        } finally {\n          span.end();\n        }\n      }\n    };\n  };\n}\n","/*\n * Copyright Traceloop\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport type * as openai from \"openai\";\nimport { context, trace, Span, Attributes, SpanKind } from \"@opentelemetry/api\";\nimport {\n  InstrumentationBase,\n  InstrumentationModuleDefinition,\n  InstrumentationNodeModuleDefinition,\n  safeExecuteInTheMiddle,\n} from \"@opentelemetry/instrumentation\";\nimport {\n  CONTEXT_KEY_ALLOW_TRACE_CONTENT,\n  SpanAttributes,\n} from \"@traceloop/ai-semantic-conventions\";\nimport { OpenAIInstrumentationConfig } from \"./types\";\nimport type {\n  ChatCompletion,\n  ChatCompletionChunk,\n  ChatCompletionCreateParamsNonStreaming,\n  ChatCompletionCreateParamsStreaming,\n  Completion,\n  CompletionChoice,\n  CompletionCreateParamsNonStreaming,\n  CompletionCreateParamsStreaming,\n} from \"openai/resources\";\nimport type { Stream } from \"openai/streaming\";\nimport { version } from \"../package.json\";\nimport { encodingForModel, TiktokenModel, Tiktoken } from \"js-tiktoken\";\n// Type definition for APIPromise - compatible with both OpenAI v4 and v5+\n// The actual import is handled at runtime via require() calls in the _wrapPromise method\ntype APIPromiseType<T> = Promise<T> & {\n  _thenUnwrap: <U>(onFulfilled: (value: T) => U) => APIPromiseType<U>;\n};\nimport {\n  wrapImageGeneration,\n  wrapImageEdit,\n  wrapImageVariation,\n} from \"./image-wrappers\";\n\nexport class OpenAIInstrumentation extends InstrumentationBase {\n  declare protected _config: OpenAIInstrumentationConfig;\n\n  constructor(config: OpenAIInstrumentationConfig = {}) {\n    super(\"@traceloop/instrumentation-openai\", version, config);\n  }\n\n  public override setConfig(config: OpenAIInstrumentationConfig = {}) {\n    super.setConfig(config);\n  }\n\n  public manuallyInstrument(module: unknown) {\n    this._diag.debug(`Manually instrumenting openai`);\n\n    const openaiModule = module as any;\n\n    this._wrap(\n      openaiModule.Chat.Completions.prototype,\n      \"create\",\n      this.patchOpenAI(\"chat\"),\n    );\n    this._wrap(\n      openaiModule.Completions.prototype,\n      \"create\",\n      this.patchOpenAI(\"completion\"),\n    );\n\n    if (openaiModule.Images) {\n      this._wrap(\n        openaiModule.Images.prototype,\n        \"generate\",\n        wrapImageGeneration(\n          this.tracer,\n          this._config.uploadBase64Image,\n          this._config,\n        ),\n      );\n      this._wrap(\n        openaiModule.Images.prototype,\n        \"edit\",\n        wrapImageEdit(\n          this.tracer,\n          this._config.uploadBase64Image,\n          this._config,\n        ),\n      );\n      this._wrap(\n        openaiModule.Images.prototype,\n        \"createVariation\",\n        wrapImageVariation(\n          this.tracer,\n          this._config.uploadBase64Image,\n          this._config,\n        ),\n      );\n    }\n  }\n\n  protected init(): InstrumentationModuleDefinition {\n    const module = new InstrumentationNodeModuleDefinition(\n      \"openai\",\n      [\">=4 <6\"],\n      this.patch.bind(this),\n      this.unpatch.bind(this),\n    );\n    return module;\n  }\n\n  private patch(moduleExports: typeof openai, moduleVersion?: string) {\n    this._diag.debug(`Patching openai@${moduleVersion}`);\n\n    // Old version of OpenAI API (v3.1.0)\n    if ((moduleExports as any).OpenAIApi) {\n      this._wrap(\n        (moduleExports as any).OpenAIApi.prototype,\n        \"createChatCompletion\",\n        this.patchOpenAI(\"chat\", \"v3\"),\n      );\n      this._wrap(\n        (moduleExports as any).OpenAIApi.prototype,\n        \"createCompletion\",\n        this.patchOpenAI(\"completion\", \"v3\"),\n      );\n    } else {\n      this._wrap(\n        moduleExports.OpenAI.Chat.Completions.prototype,\n        \"create\",\n        this.patchOpenAI(\"chat\"),\n      );\n      this._wrap(\n        moduleExports.OpenAI.Completions.prototype,\n        \"create\",\n        this.patchOpenAI(\"completion\"),\n      );\n\n      if (moduleExports.OpenAI.Images) {\n        this._wrap(\n          moduleExports.OpenAI.Images.prototype,\n          \"generate\",\n          wrapImageGeneration(\n            this.tracer,\n            this._config.uploadBase64Image,\n            this._config,\n          ),\n        );\n        this._wrap(\n          moduleExports.OpenAI.Images.prototype,\n          \"edit\",\n          wrapImageEdit(\n            this.tracer,\n            this._config.uploadBase64Image,\n            this._config,\n          ),\n        );\n        this._wrap(\n          moduleExports.OpenAI.Images.prototype,\n          \"createVariation\",\n          wrapImageVariation(\n            this.tracer,\n            this._config.uploadBase64Image,\n            this._config,\n          ),\n        );\n      }\n    }\n    return moduleExports;\n  }\n\n  private unpatch(moduleExports: typeof openai, moduleVersion?: string): void {\n    this._diag.debug(`Unpatching openai@${moduleVersion}`);\n\n    // Old version of OpenAI API (v3.1.0)\n    if ((moduleExports as any).OpenAIApi) {\n      this._unwrap(\n        (moduleExports as any).OpenAIApi.prototype,\n        \"createChatCompletion\",\n      );\n      this._unwrap(\n        (moduleExports as any).OpenAIApi.prototype,\n        \"createCompletion\",\n      );\n    } else {\n      this._unwrap(moduleExports.OpenAI.Chat.Completions.prototype, \"create\");\n      this._unwrap(moduleExports.OpenAI.Completions.prototype, \"create\");\n\n      if (moduleExports.OpenAI.Images) {\n        this._unwrap(moduleExports.OpenAI.Images.prototype, \"generate\");\n        this._unwrap(moduleExports.OpenAI.Images.prototype, \"edit\");\n        this._unwrap(moduleExports.OpenAI.Images.prototype, \"createVariation\");\n      }\n    }\n  }\n\n  private patchOpenAI(\n    type: \"chat\" | \"completion\",\n    version: \"v3\" | \"v4\" = \"v4\",\n  ) {\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const plugin = this;\n    // eslint-disable-next-line\n    return (original: Function) => {\n      return function method(this: any, ...args: unknown[]) {\n        const span =\n          type === \"chat\"\n            ? plugin.startSpan({\n                type,\n                params: args[0] as ChatCompletionCreateParamsNonStreaming & {\n                  extraAttributes?: Record<string, any>;\n                },\n                client: this,\n              })\n            : plugin.startSpan({\n                type,\n                params: args[0] as CompletionCreateParamsNonStreaming & {\n                  extraAttributes?: Record<string, any>;\n                },\n                client: this,\n              });\n\n        const execContext = trace.setSpan(context.active(), span);\n        const execPromise = safeExecuteInTheMiddle(\n          () => {\n            return context.with(execContext, () => {\n              if ((args?.[0] as any)?.extraAttributes) {\n                delete (args[0] as any).extraAttributes;\n              }\n              return original.apply(this, args);\n            });\n          },\n          (e) => {\n            if (e) {\n              plugin._diag.error(\"OpenAI instrumentation: error\", e);\n            }\n          },\n        );\n\n        if (\n          (\n            args[0] as\n              | ChatCompletionCreateParamsStreaming\n              | CompletionCreateParamsStreaming\n          ).stream\n        ) {\n          return context.bind(\n            execContext,\n            plugin._streamingWrapPromise({\n              span,\n              type,\n              params: args[0] as any,\n              promise: execPromise,\n            }),\n          );\n        }\n\n        const wrappedPromise = plugin._wrapPromise(\n          type,\n          version,\n          span,\n          execPromise,\n        );\n\n        return context.bind(execContext, wrappedPromise as any);\n      };\n    };\n  }\n\n  private startSpan({\n    type,\n    params,\n    client,\n  }:\n    | {\n        type: \"chat\";\n        params: ChatCompletionCreateParamsNonStreaming & {\n          extraAttributes?: Record<string, any>;\n        };\n        client: any;\n      }\n    | {\n        type: \"completion\";\n        params: CompletionCreateParamsNonStreaming & {\n          extraAttributes?: Record<string, any>;\n        };\n        client: any;\n      }): Span {\n    const { provider } = this._detectVendorFromURL(client);\n\n    const attributes: Attributes = {\n      [SpanAttributes.LLM_SYSTEM]: provider,\n      [SpanAttributes.LLM_REQUEST_TYPE]: type,\n    };\n\n    try {\n      attributes[SpanAttributes.LLM_REQUEST_MODEL] = params.model;\n      if (params.max_tokens) {\n        attributes[SpanAttributes.LLM_REQUEST_MAX_TOKENS] = params.max_tokens;\n      }\n      if (params.temperature) {\n        attributes[SpanAttributes.LLM_REQUEST_TEMPERATURE] = params.temperature;\n      }\n      if (params.top_p) {\n        attributes[SpanAttributes.LLM_REQUEST_TOP_P] = params.top_p;\n      }\n      if (params.frequency_penalty) {\n        attributes[SpanAttributes.LLM_FREQUENCY_PENALTY] =\n          params.frequency_penalty;\n      }\n      if (params.presence_penalty) {\n        attributes[SpanAttributes.LLM_PRESENCE_PENALTY] =\n          params.presence_penalty;\n      }\n\n      if (\n        params.extraAttributes !== undefined &&\n        typeof params.extraAttributes === \"object\"\n      ) {\n        Object.keys(params.extraAttributes).forEach((key: string) => {\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          attributes[key] = params.extraAttributes![key];\n        });\n      }\n\n      if (this._shouldSendPrompts()) {\n        if (type === \"chat\") {\n          params.messages.forEach((message, index) => {\n            attributes[`${SpanAttributes.LLM_PROMPTS}.${index}.role`] =\n              message.role;\n            if (typeof message.content === \"string\") {\n              attributes[`${SpanAttributes.LLM_PROMPTS}.${index}.content`] =\n                (message.content as string) || \"\";\n            } else {\n              attributes[`${SpanAttributes.LLM_PROMPTS}.${index}.content`] =\n                JSON.stringify(message.content);\n            }\n          });\n          params.functions?.forEach((func, index) => {\n            attributes[\n              `${SpanAttributes.LLM_REQUEST_FUNCTIONS}.${index}.name`\n            ] = func.name;\n            attributes[\n              `${SpanAttributes.LLM_REQUEST_FUNCTIONS}.${index}.description`\n            ] = func.description;\n            attributes[\n              `${SpanAttributes.LLM_REQUEST_FUNCTIONS}.${index}.arguments`\n            ] = JSON.stringify(func.parameters);\n          });\n          params.tools?.forEach((tool, index) => {\n            if (\n              tool.type !== \"function\" ||\n              !(\"function\" in tool) ||\n              !tool.function\n            ) {\n              return;\n            }\n\n            attributes[\n              `${SpanAttributes.LLM_REQUEST_FUNCTIONS}.${index}.name`\n            ] = tool.function.name;\n            attributes[\n              `${SpanAttributes.LLM_REQUEST_FUNCTIONS}.${index}.description`\n            ] = tool.function.description;\n            attributes[\n              `${SpanAttributes.LLM_REQUEST_FUNCTIONS}.${index}.arguments`\n            ] = JSON.stringify(tool.function.parameters);\n          });\n        } else {\n          attributes[`${SpanAttributes.LLM_PROMPTS}.0.role`] = \"user\";\n          if (typeof params.prompt === \"string\") {\n            attributes[`${SpanAttributes.LLM_PROMPTS}.0.content`] =\n              params.prompt;\n          } else {\n            attributes[`${SpanAttributes.LLM_PROMPTS}.0.content`] =\n              JSON.stringify(params.prompt);\n          }\n        }\n      }\n    } catch (e) {\n      this._diag.debug(e);\n      this._config.exceptionLogger?.(e);\n    }\n\n    return this.tracer.startSpan(`openai.${type}`, {\n      kind: SpanKind.CLIENT,\n      attributes,\n    });\n  }\n\n  private async *_streamingWrapPromise({\n    span,\n    type,\n    params,\n    promise,\n  }:\n    | {\n        span: Span;\n        type: \"chat\";\n        params: ChatCompletionCreateParamsStreaming;\n        promise: APIPromiseType<Stream<ChatCompletionChunk>>;\n      }\n    | {\n        span: Span;\n        params: CompletionCreateParamsStreaming;\n        type: \"completion\";\n        promise: APIPromiseType<Stream<Completion>>;\n      }) {\n    if (type === \"chat\") {\n      const result: ChatCompletion = {\n        id: \"0\",\n        created: -1,\n        model: \"\",\n        choices: [\n          {\n            index: 0,\n            logprobs: null,\n            finish_reason: \"stop\",\n            message: {\n              role: \"assistant\",\n              content: \"\",\n              tool_calls: [],\n            } as any,\n          },\n        ],\n        object: \"chat.completion\",\n      };\n      for await (const chunk of await promise) {\n        yield chunk;\n\n        result.id = chunk.id;\n        result.created = chunk.created;\n        result.model = chunk.model;\n\n        if (chunk.choices[0]?.finish_reason) {\n          result.choices[0].finish_reason = chunk.choices[0].finish_reason;\n        }\n        if (chunk.choices[0]?.logprobs) {\n          result.choices[0].logprobs = chunk.choices[0].logprobs;\n        }\n        if (chunk.choices[0]?.delta.content) {\n          result.choices[0].message.content += chunk.choices[0].delta.content;\n        }\n        if (\n          chunk.choices[0]?.delta.function_call &&\n          chunk.choices[0]?.delta.function_call.arguments &&\n          chunk.choices[0]?.delta.function_call.name\n        ) {\n          // I needed to re-build the object so that Typescript will understand that `name` and `argument` are not null.\n          result.choices[0].message.function_call = {\n            name: chunk.choices[0].delta.function_call.name,\n            arguments: chunk.choices[0].delta.function_call.arguments,\n          };\n        }\n        for (const toolCall of chunk.choices[0]?.delta?.tool_calls ?? []) {\n          if (\n            (result.choices[0].message.tool_calls?.length ?? 0) <\n            toolCall.index + 1\n          ) {\n            result.choices[0].message.tool_calls?.push({\n              function: {\n                name: \"\",\n                arguments: \"\",\n              },\n              id: \"\",\n              type: \"function\",\n            });\n          }\n\n          if (result.choices[0].message.tool_calls) {\n            if (toolCall.id) {\n              result.choices[0].message.tool_calls[toolCall.index].id +=\n                toolCall.id;\n            }\n            if (toolCall.type) {\n              result.choices[0].message.tool_calls[toolCall.index].type =\n                toolCall.type;\n            }\n            if (toolCall.function?.name) {\n              (\n                result.choices[0].message.tool_calls[toolCall.index] as any\n              ).function.name += toolCall.function.name;\n            }\n            if (toolCall.function?.arguments) {\n              (\n                result.choices[0].message.tool_calls[toolCall.index] as any\n              ).function.arguments += toolCall.function.arguments;\n            }\n          }\n        }\n      }\n\n      if (result.choices[0].logprobs?.content) {\n        this._addLogProbsEvent(span, result.choices[0].logprobs);\n      }\n\n      if (this._config.enrichTokens) {\n        let promptTokens = 0;\n        for (const message of params.messages) {\n          promptTokens +=\n            this.tokenCountFromString(\n              message.content as string,\n              result.model,\n            ) ?? 0;\n        }\n\n        const completionTokens = this.tokenCountFromString(\n          result.choices[0].message.content ?? \"\",\n          result.model,\n        );\n        if (completionTokens) {\n          result.usage = {\n            prompt_tokens: promptTokens,\n            completion_tokens: completionTokens,\n            total_tokens: promptTokens + completionTokens,\n          };\n        }\n      }\n\n      this._endSpan({ span, type, result });\n    } else {\n      const result: Completion = {\n        id: \"0\",\n        created: -1,\n        model: \"\",\n        choices: [\n          {\n            index: 0,\n            logprobs: null,\n            finish_reason: \"stop\",\n            text: \"\",\n          },\n        ],\n        object: \"text_completion\",\n      };\n      for await (const chunk of await promise) {\n        yield chunk;\n\n        try {\n          result.id = chunk.id;\n          result.created = chunk.created;\n          result.model = chunk.model;\n\n          if (chunk.choices[0]?.finish_reason) {\n            result.choices[0].finish_reason = chunk.choices[0].finish_reason;\n          }\n          if (chunk.choices[0]?.logprobs) {\n            result.choices[0].logprobs = chunk.choices[0].logprobs;\n          }\n          if (chunk.choices[0]?.text) {\n            result.choices[0].text += chunk.choices[0].text;\n          }\n        } catch (e) {\n          this._diag.debug(e);\n          this._config.exceptionLogger?.(e);\n        }\n      }\n\n      try {\n        if (result.choices[0].logprobs) {\n          this._addLogProbsEvent(span, result.choices[0].logprobs);\n        }\n\n        if (this._config.enrichTokens) {\n          const promptTokens =\n            this.tokenCountFromString(params.prompt as string, result.model) ??\n            0;\n\n          const completionTokens = this.tokenCountFromString(\n            result.choices[0].text ?? \"\",\n            result.model,\n          );\n          if (completionTokens) {\n            result.usage = {\n              prompt_tokens: promptTokens,\n              completion_tokens: completionTokens,\n              total_tokens: promptTokens + completionTokens,\n            };\n          }\n        }\n      } catch (e) {\n        this._diag.debug(e);\n        this._config.exceptionLogger?.(e);\n      }\n\n      this._endSpan({ span, type, result });\n    }\n  }\n\n  private _wrapPromise<T>(\n    type: \"chat\" | \"completion\",\n    version: \"v3\" | \"v4\",\n    span: Span,\n    promise: APIPromiseType<T>,\n  ): APIPromiseType<T> {\n    return promise._thenUnwrap((result) => {\n      if (version === \"v3\") {\n        if (type === \"chat\") {\n          this._addLogProbsEvent(\n            span,\n            ((result as any).data as ChatCompletion).choices[0].logprobs,\n          );\n          this._endSpan({\n            type,\n            span,\n            result: (result as any).data as ChatCompletion,\n          });\n        } else {\n          this._addLogProbsEvent(\n            span,\n            ((result as any).data as Completion).choices[0].logprobs,\n          );\n          this._endSpan({\n            type,\n            span,\n            result: (result as any).data as Completion,\n          });\n        }\n      } else {\n        if (type === \"chat\") {\n          this._addLogProbsEvent(\n            span,\n            (result as ChatCompletion).choices[0].logprobs,\n          );\n          this._endSpan({ type, span, result: result as ChatCompletion });\n        } else {\n          this._addLogProbsEvent(\n            span,\n            (result as Completion).choices[0].logprobs,\n          );\n          this._endSpan({ type, span, result: result as Completion });\n        }\n      }\n\n      return result;\n    });\n  }\n\n  private _endSpan({\n    span,\n    type,\n    result,\n  }:\n    | { span: Span; type: \"chat\"; result: ChatCompletion }\n    | { span: Span; type: \"completion\"; result: Completion }) {\n    try {\n      span.setAttribute(SpanAttributes.LLM_RESPONSE_MODEL, result.model);\n      if (result.usage) {\n        span.setAttribute(\n          SpanAttributes.LLM_USAGE_TOTAL_TOKENS,\n          result.usage?.total_tokens,\n        );\n        span.setAttribute(\n          SpanAttributes.LLM_USAGE_COMPLETION_TOKENS,\n          result.usage?.completion_tokens,\n        );\n        span.setAttribute(\n          SpanAttributes.LLM_USAGE_PROMPT_TOKENS,\n          result.usage?.prompt_tokens,\n        );\n      }\n\n      if (this._shouldSendPrompts()) {\n        if (type === \"chat\") {\n          result.choices.forEach((choice, index) => {\n            span.setAttribute(\n              `${SpanAttributes.LLM_COMPLETIONS}.${index}.finish_reason`,\n              choice.finish_reason,\n            );\n            span.setAttribute(\n              `${SpanAttributes.LLM_COMPLETIONS}.${index}.role`,\n              choice.message.role,\n            );\n            span.setAttribute(\n              `${SpanAttributes.LLM_COMPLETIONS}.${index}.content`,\n              choice.message.content ?? \"\",\n            );\n\n            if (choice.message.function_call) {\n              span.setAttribute(\n                `${SpanAttributes.LLM_COMPLETIONS}.${index}.function_call.name`,\n                choice.message.function_call.name,\n              );\n              span.setAttribute(\n                `${SpanAttributes.LLM_COMPLETIONS}.${index}.function_call.arguments`,\n                choice.message.function_call.arguments,\n              );\n            }\n            for (const [\n              toolIndex,\n              toolCall,\n            ] of choice?.message?.tool_calls?.entries() || []) {\n              if (toolCall.type === \"function\" && \"function\" in toolCall) {\n                span.setAttribute(\n                  `${SpanAttributes.LLM_COMPLETIONS}.${index}.tool_calls.${toolIndex}.name`,\n                  toolCall.function.name,\n                );\n                span.setAttribute(\n                  `${SpanAttributes.LLM_COMPLETIONS}.${index}.tool_calls.${toolIndex}.arguments`,\n                  toolCall.function.arguments,\n                );\n              }\n            }\n          });\n        } else {\n          result.choices.forEach((choice, index) => {\n            span.setAttribute(\n              `${SpanAttributes.LLM_COMPLETIONS}.${index}.finish_reason`,\n              choice.finish_reason,\n            );\n            span.setAttribute(\n              `${SpanAttributes.LLM_COMPLETIONS}.${index}.role`,\n              \"assistant\",\n            );\n            span.setAttribute(\n              `${SpanAttributes.LLM_COMPLETIONS}.${index}.content`,\n              choice.text,\n            );\n          });\n        }\n      }\n    } catch (e) {\n      this._diag.debug(e);\n      this._config.exceptionLogger?.(e);\n    }\n\n    span.end();\n  }\n\n  private _shouldSendPrompts() {\n    const contextShouldSendPrompts = context\n      .active()\n      .getValue(CONTEXT_KEY_ALLOW_TRACE_CONTENT);\n\n    if (contextShouldSendPrompts !== undefined) {\n      return contextShouldSendPrompts;\n    }\n\n    return this._config.traceContent !== undefined\n      ? this._config.traceContent\n      : true;\n  }\n\n  private _addLogProbsEvent(\n    span: Span,\n    logprobs:\n      | ChatCompletion.Choice.Logprobs\n      | ChatCompletionChunk.Choice.Logprobs\n      | CompletionChoice.Logprobs\n      | null,\n  ) {\n    try {\n      let result: { token: string; logprob: number }[] = [];\n\n      if (!logprobs) {\n        return;\n      }\n\n      const chatLogprobs = logprobs as\n        | ChatCompletion.Choice.Logprobs\n        | ChatCompletionChunk.Choice.Logprobs;\n      const completionLogprobs = logprobs as CompletionChoice.Logprobs;\n      if (chatLogprobs.content) {\n        result = chatLogprobs.content.map((logprob) => {\n          return {\n            token: logprob.token,\n            logprob: logprob.logprob,\n          };\n        });\n      } else if (\n        completionLogprobs?.tokens &&\n        completionLogprobs?.token_logprobs\n      ) {\n        completionLogprobs.tokens.forEach((token, index) => {\n          const logprob = completionLogprobs.token_logprobs?.[index];\n          if (logprob) {\n            result.push({\n              token,\n              logprob,\n            });\n          }\n        });\n      }\n\n      span.addEvent(\"logprobs\", { logprobs: JSON.stringify(result) });\n    } catch (e) {\n      this._diag.debug(e);\n      this._config.exceptionLogger?.(e);\n    }\n  }\n\n  private _encodingCache = new Map<string, Tiktoken>();\n\n  private tokenCountFromString(text: string, model: string) {\n    if (!text) {\n      return 0;\n    }\n\n    let encoding = this._encodingCache.get(model);\n\n    if (!encoding) {\n      try {\n        encoding = encodingForModel(model as TiktokenModel);\n        this._encodingCache.set(model, encoding);\n      } catch (e) {\n        this._diag.debug(e);\n        this._config.exceptionLogger?.(e);\n        return 0;\n      }\n    }\n\n    return encoding.encode(text).length;\n  }\n\n  private _detectVendorFromURL(client: any): {\n    provider: string;\n    modelVendor: string;\n  } {\n    const modelVendor = \"OpenAI\";\n\n    try {\n      if (!client?.baseURL) {\n        return { provider: \"OpenAI\", modelVendor };\n      }\n\n      const baseURL = client.baseURL.toLowerCase();\n\n      if (baseURL.includes(\"azure\") || baseURL.includes(\"openai.azure.com\")) {\n        return { provider: \"Azure\", modelVendor };\n      }\n\n      if (\n        baseURL.includes(\"openai.com\") ||\n        baseURL.includes(\"api.openai.com\")\n      ) {\n        return { provider: \"OpenAI\", modelVendor };\n      }\n\n      if (baseURL.includes(\"amazonaws.com\") || baseURL.includes(\"bedrock\")) {\n        return { provider: \"AWS\", modelVendor };\n      }\n\n      if (baseURL.includes(\"googleapis.com\")) {\n        return { provider: \"Google\", modelVendor };\n      }\n\n      if (baseURL.includes(\"openrouter\")) {\n        return { provider: \"OpenRouter\", modelVendor };\n      }\n\n      return { provider: \"OpenAI\", modelVendor };\n    } catch (e) {\n      this._diag.debug(`Failed to detect vendor from URL: ${e}`);\n      return { provider: \"OpenAI\", modelVendor };\n    }\n  }\n}\n"],"names":["__awaiter","SpanAttributes","SpanKind","InstrumentationBase","InstrumentationNodeModuleDefinition","trace","context","safeExecuteInTheMiddle","__asyncGenerator","__asyncValues","__await","CONTEXT_KEY_ALLOW_TRACE_CONTENT","encodingForModel"],"mappings":"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"}